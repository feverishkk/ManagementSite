@page "/customeringameinfo/{UserId}"
@attribute [Authorize(Roles = "SuperAdministrator, ServerAdministrator")]

<MudTable Items="@InGameInfo" Hover="true" Breakpoint="Breakpoint.Sm" LoadingProgressColor="Color.Info">
    <HeaderContent>
        <MudTh>Game Character Name</MudTh>
        <MudTh>Guild Name</MudTh>
        <MudTh>Game Character Class</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Game Character Name">@context.UserName</MudTd>
        <MudTd DataLabel="GuildName">@context?.GuildName</MudTd>
        <MudTd DataLabel="Game Character Class"> @context.UserClass</MudTd>
    </RowTemplate>
</MudTable>


<MudTable Items="@CustomersEquipment" Hover="true" Breakpoint="Breakpoint.Sm" LoadingProgressColor="Color.Info">
    <HeaderContent>
        <MudTh>Weapon</MudTh>
        <MudTh>TShirt</MudTh>
        <MudTh>Armor</MudTh>
        <MudTh>Cape</MudTh>
        <MudTh>Helmet</MudTh>
        <MudTh>Neckless</MudTh>
        <MudTh>Ring 1</MudTh>
        <MudTh>Ring 2</MudTh>
        <MudTh>Belt</MudTh>
        <MudTh>Boots</MudTh>
        <MudTh>Ear Ring</MudTh>
        <MudTh>Guard</MudTh>
        <MudTh>Globe</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Weapon">@context.TotalWeapons.Name</MudTd>
        <MudTd DataLabel="TShirt">@context?.TShirt?.Name</MudTd>
        <MudTd DataLabel="Armor">@context?.Armor?.Name</MudTd>
        <MudTd DataLabel="Cape"> @context?.Cape?.Name</MudTd>
        <MudTd DataLabel="Helmet"> @context?.Helmet?.Name  </MudTd>
        <MudTd DataLabel="Neckless"> @context?.Neckless?.Name  </MudTd>
        <MudTd DataLabel="Ring 1"> @context?.Ring1?.Name</MudTd>
        <MudTd DataLabel="Ring 2"> @context?.Ring2?.Name</MudTd>
        <MudTd DataLabel="Belt"> @context?.Belt?.Name</MudTd>
        <MudTd DataLabel="Boots"> @context?.Boots?.Name</MudTd>
        <MudTd DataLabel="Ear Ring"> @context?.EarRing?.Name</MudTd>
        <MudTd DataLabel="Guard"> @context?.Guard?.Name</MudTd>
        <MudTd DataLabel="Globe"> @context?.Globe?.Name</MudTd>
    </RowTemplate>
</MudTable>


<MudCard>
    <MudForm Model="@BeltModel" @ref="@form">
        <MudCardContent>
            <MudSelect Label="Belt" @bind-Value="BeltModel.BeltId" For="@(()=>BeltModel.BeltId)">
                @foreach (var belt in Belts)
                {
                    <MudSelectItem Value="@belt.BeltId">@belt.Name</MudSelectItem>
                }
            </MudSelect>
        </MudCardContent>
        <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary"
                   @onclick="@(()=>OnSelect(BeltModel, UserId))">
            Update
        </MudButton>
    </MudForm>
</MudCard>


@code {
    [Parameter]
    public string UserId { get; set; }

    MudForm form;
    private MudTable<CustomersViewModel> table;

    public Belt BeltModel = new Belt();
    private EarRing EarRingModel = new EarRing();


    private IEnumerable<CustomersInGameInfoViewModel> InGameInfo = new List<CustomersInGameInfoViewModel>();
    private IEnumerable<CustomerEquipmentViewModel> CustomersEquipment = new List<CustomerEquipmentViewModel>();

    private IEnumerable<Belt> Belts = new List<Belt>();
    private IEnumerable<EarRing> EarRings = new List<EarRing>();

    protected override async Task OnInitializedAsync()
    {
        await LoadData();
        await base.OnInitializedAsync();
    }

    private async Task LoadData()
    {
        InGameInfo = await _customersHttpService.CustomersInGameInfo(UserId);
        CustomersEquipment = await _customersHttpService.CustomersEquipment(UserId);
        Belts = await _getItemHttpService.GetBelt();
        //EarRings = await _commDbService.GetEarRings();
        //Accs = await _commonDbService.GetAcc();
    }

    public async Task OnSelect(Belt belt, string userId)
    {
        ArrayList userInfo = new ArrayList();

        userInfo.Add(belt.BeltId);
        userInfo.Add(userId);
        await _updateItemHttpService.UpdateCustomerEquipment(userInfo);

        StateHasChanged();
    }

}
